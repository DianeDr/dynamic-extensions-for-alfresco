<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<description>Configures OSGi framework and related services.</description>

	<bean id="osgi.container.Configuration" class="nl.runnable.alfresco.osgi.Configuration">
		<description>Specifies the global OSGI container configuration.</description>
		<property name="mode" value="${osgi.container.mode:DEVELOPMENT}" />
		<property name="bundleDirectory" value="${osgi.container.bundle-directory:dynamic-extensions}" />
		<property name="storageDirectory" value="${osgi.container.storage-directory:tmp}" />
	</bean>

	<bean id="osgi.container.FrameworkConfiguration" class="nl.runnable.alfresco.osgi.FrameworkConfiguration">
		<property name="configuration" ref="osgi.container.Configuration" />
		<property name="additionalSystemPackages" ref="osgi.container.SystemPackages">
			<description>Refers to the system package configuration.</description>
		</property>
	</bean>

	<bean id="osgi.container.Framework" class="nl.runnable.alfresco.osgi.felix.FelixFrameworkFactoryBean">
		<property name="frameworkConfiguration" ref="osgi.container.FrameworkConfiguration" />
	</bean>

	<bean id="osgi.container.ServiceBundleContextRegistrar" class="nl.runnable.alfresco.osgi.ServiceBundleContextRegistrar">
		<description>
			Registers the host application services with the OSGi Framework.
		</description>
		<property name="descriptorService" ref="DescriptorService" />
		<property name="serviceDefinitions" ref="osgi.container.HostServices" />
		<property name="servicePropertiesProviders">
			<list>
				<bean class="nl.runnable.alfresco.osgi.HostApplicationServicePropertiesProvider">
					<description>
						Adds a "hostApplication" property to each host application service registered as an OSGi service.
					</description>
					<property name="hostApplication" value="alfresco" />
				</bean>
			</list>
		</property>
	</bean>

	<bean id="osgi.container.ApplicationContextBundleContextRegistrar" class="nl.runnable.alfresco.osgi.ApplicationContextBundleContextRegistrar">
		<description>Registers this application context as an OSGi service.</description>
	</bean>

	<bean id="osgi.container.FrameworkManager" class="nl.runnable.alfresco.osgi.FrameworkManager" init-method="initialize"
		destroy-method="destroy">
		<description>
			Manages the lifecycle of the OSGi Framework and registers services and listeners.
		</description>
		<property name="framework" ref="osgi.container.Framework" />
		<property name="bundleContextRegistrars">
			<list>
				<ref bean="osgi.container.ServiceBundleContextRegistrar" />
				<ref bean="osgi.container.ApplicationContextBundleContextRegistrar" />
			</list>
		</property>
		<property name="blueprintBundlesLocation" value="classpath:/alfresco/module/%module.id%/blueprint-bundles/*.jar" />
		<property name="fileInstallBundlesLocation" value="classpath:/alfresco/module/%module.id%/file-install-bundles/*.jar" />
		<property name="standardBundlesLocation" value="classpath:/alfresco/module/%module.id%/standard-bundles/*.jar" />
		<property name="fileInstallConfigurer" ref="osgi.container.FileInstallConfigurer" />
		<property name="configuration" ref="osgi.container.Configuration" />
		<property name="repositoryStoreService" ref="osgi.container.RepositoryStoreService" />
		<property name="contentService" ref="contentService" />
	</bean>

	<bean id="osgi.container.FileInstallConfigurer" class="nl.runnable.alfresco.osgi.FileInstallConfigurer"
		init-method="configureSettings">
		<property name="configuration" ref="osgi.container.Configuration" />
	</bean>

	<bean id="osgi.container.RepositoryStoreService" class="nl.runnable.alfresco.osgi.RepositoryStoreService">
		<property name="namespacePrefixResolver" ref="namespaceService" />
		<property name="nodeService" ref="nodeService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="baseFolderDescription">
			<value>
				Dynamic Extensions for Alfresco. https://github.com/lfridael/dynamic-extensions-for-alfresco
			</value>
		</property>
		<property name="bundleFolderDescription">
			<value>
				Dynamic Extension OSGi bundle JARs.
			</value>
		</property>
		<property name="configurationFolderDescription">
			<value>
				Configuration files for Dynamic Extensions.
			</value>
		</property>
	</bean>


</beans>